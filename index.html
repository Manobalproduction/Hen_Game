<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Camera & Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100vh;
      background: transparent;
    }
    #camera {
      flex: 1;
      width: 100%;
      background: black;
      object-fit: cover;
    }
    #gameContainer {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      background: transparent;
    }
    canvas {
      display: block;
      background: transparent;
    }
  </style>
</head>
<body>
  <!-- Camera feed -->
  <video id="camera" autoplay muted></video>
  
  <!-- Game area -->
  <div id="gameContainer">
    <canvas id="marioGame"></canvas>
  </div>

  <script>
    const canvas = document.getElementById("marioGame");
    const ctx = canvas.getContext("2d");

    // Set canvas dimensions to match the bottom half
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight / 2;

    // Variables for the game
    let mario;
    let ground = canvas.height - 50;
    let gravity = 0.8;
    let jumpStrength = -10; // Reduced jump distance
    let moveSpeed = 5;
    let isJumping = false;

    // Initialize Mario
    function init() {
      mario = {
        x: 50,
        y: ground - 40,
        width: 40,
        height: 40,
        velocityY: 0,
      };
      update();
    }

    // Draw Mario
    function drawMario() {
      ctx.fillStyle = "blue";
      ctx.fillRect(mario.x, mario.y, mario.width, mario.height);
    }

    // Draw ground
    function drawGround() {
      ctx.fillStyle = "#228B22";
      ctx.fillRect(0, ground, canvas.width, 50);
    }

    // Event listeners for movement
    document.body.addEventListener("keydown", (event) => {
      if (event.key === "ArrowLeft" && mario.x > 0) {
        mario.x -= moveSpeed; // Move left
      } else if (event.key === "ArrowRight" && mario.x + mario.width < canvas.width) {
        mario.x += moveSpeed; // Move right
      } else if (event.key === " " && !isJumping) {
        mario.velocityY = jumpStrength; // Jump
        mario.x += moveSpeed * 0.4; // Forward movement while jumping
        isJumping = true;
      }
    });

    // Update game loop
    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Apply gravity
      mario.velocityY += gravity;
      mario.y += mario.velocityY;

      // Check ground collision
      if (mario.y + mario.height >= ground) {
        mario.y = ground - mario.height;
        mario.velocityY = 0;
        isJumping = false;
      }

      // Prevent Mario from going off-screen
      if (mario.x < 0) mario.x = 0;
      if (mario.x + mario.width > canvas.width) mario.x = canvas.width - mario.width;

      // Draw game elements
      drawGround();
      drawMario();

      requestAnimationFrame(update);
    }

    // Initialize camera
    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
        const camera = document.getElementById("camera");
        camera.srcObject = stream;
      } catch (error) {
        console.error("Error accessing the camera:", error);
        alert("Unable to access the camera. Please allow camera access.");
      }
    }

    // Start the game and camera
    window.onload = () => {
      startCamera();
      init();
    };
  </script>
</body>
</html>
